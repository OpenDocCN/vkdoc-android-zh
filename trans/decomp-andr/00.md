## 前言

《反编译 Java》最初出版于 2004 年，由于多种原因，对于对反编译感兴趣的人来说，它更像是一本深奥的书，而不是面向普通编程读者的任何东西。

早在 1998 年我开始写这本书的时候，网站上有很多小应用程序，一想到有人可以下载你的辛勤工作并将其逆向工程成 Java 源代码，对许多人来说是一个可怕的想法。但是小程序和拨号上网走的是同一条路，我怀疑这本书的许多读者从来没有在网页上见过小程序。

在这本书出版后，我意识到有人反编译你的 Java 类文件的唯一方法是首先侵入你的 web 服务器并从那里下载它们。如果他们做到了这一点，你就比人们反编译你的代码要担心得多。

除了一些明显的例外——比如 Corel 的 Java for Office 作为桌面应用程序运行，以及其他 Swing 应用程序——十多年来，Java 代码主要存在于服务器上。客户端浏览器上几乎没有任何东西，对类文件的零访问意味着零反编译问题。但奇怪的是，随着 Android 平台的出现，这一切都发生了变化:你的 Android 应用程序存在于你的移动设备上，可以被编程知识非常有限的人轻松下载并进行逆向工程。

一个 Android 应用程序以 APK 文件的形式下载到你的设备上，该文件包括所有的图像和资源以及存储在单个`classes.dex`文件中的代码。这是一种与 Java 类文件非常不同的格式，设计用于在 Android Dalvik 虚拟机(DVM)上运行。但是可以很容易地将其转换回 Java 类文件，并反编译回原始源代码。

反编译是将机器可读代码转换为人类可读格式的过程。当一个可执行文件或者一个 Java 类文件或者一个 DLL 被反编译时，你并不能完全得到原始的格式；相反，你得到的是一种伪源代码，它通常是不完整的，而且几乎总是没有注释。但是，通常，理解原始代码就足够了。

*反编译 Android* 解决了编程社区中未被满足的需求。出于某种原因，反编译 Android APKs 的能力在很大程度上被忽略了，尽管对于任何有适当思维的人来说，将 APK 反编译回 Java 代码都相对容易。这本书通过观察那些试图恢复源代码的人和那些试图使用混淆等方法保护源代码的人目前使用的工具和技巧来重新平衡。

这本书是为那些想通过反编译来学习 Android 编程的人，那些只想学习如何将 Android 应用程序反编译成源代码的人，那些想保护他们的 Android 代码的人，以及最后，那些想通过构建一个`.dex`反编译程序来更好地理解`.dex`字节码和 DVM 的人。

本书通过以下方式让你对反编译器和混淆器的理解更上一层楼

> *   Explore Java bytecode and opcode in detail.
> *   Study the structure of DEX file and opcode, and explain its relationship with Java class files.
> *   The difference between, with examples to show you how to decompile Android APK files.
> *   Give simple strategies to show you how to protect your code.
> *   Show you to build your own decompiler and obfuscator.

*反编译 Android* 不是一般的 Android 编程书。事实上，这与作者教你如何将想法和概念转化为代码的标准教科书完全相反。您对将部分编译的 Android 操作码转换回源代码感兴趣，这样您就可以了解最初的程序员在想什么。除了与操作码和 DVM 相关的地方，我不会深入讨论语言结构。所有的重点都放在低级虚拟机设计上，而不是语言语法上。

本书的第一部分解释了 APK 格式，并向您展示了 Java 代码是如何存储在 DEX 文件中并随后由 DVM 执行的。你还会看到反编译和混淆的理论和实践。我展示了一些反编译器的技巧，并解释了如何解开最尴尬的 APK。您了解了人们试图保护其源代码的不同方式；在适当的时候，我会揭露这些技术的任何缺陷或潜在问题，以便您在使用任何源代码保护工具之前得到适当的通知。

本书的第二部分主要关注如何编写你自己的 Android 反编译程序和混淆器。您构建了一个可扩展的 Android 字节码反编译程序。尽管 Java 虚拟机(JVM)的设计是固定的，但语言却不是。许多早期的反编译器不能处理 JDK 1.1 中出现的 Java 结构，比如内部类。因此，如果新的构造出现在`classes.dex`中，您将准备好处理它们。