# 四十四、替代环境的作用

你可能会认为 Android 全是 Java。官方的 Android 软件开发工具包(SDK)是用于 Java 开发的，构建工具是用于 Java 开发的，Android 讨论组和博客帖子都是关于 Java 的，是的，大多数 Android 书籍都是用于 Java 开发的。见鬼，这本书的大部分都是关于 Java 的。

然而(向威廉姆·高德曼道歉)，Android 只是大部分是 Java。大部分 Java 和全 Java 有很大的区别。大多 Java 稍微不是 Java。

因此，虽然 Android 的“最佳点”在短期内仍将是基于 Java 的应用，但您仍然可以使用其他技术创建应用。本章和接下来的三章将介绍一些替代技术。

本章首先分析了 Android 以 Java 为中心的策略的利弊。然后，它列举了一些原因，为什么你可能想使用其他东西的 Android 应用。还讨论了替代 Android 应用环境的缺点——缺乏支持和技术挑战。

### 起初，有 Java...

Android 核心团队在选择 Java 的时候，做了一个相当合理的语言选择。它是一种非常流行的语言，在移动社区中，它的前身是 Java 2 Platform，Micro Edition (J2ME)。由于缺乏对内存地址(所谓的指针)的直接访问，基于 Java 的应用不太容易出现开发人员的错误，这些错误可能会导致缓冲区溢出，并使应用暴露在可能的攻击之下。围绕 Java 有一个相当健壮的生态系统，包括教育材料、现有的代码库、集成开发环境(ide)等等。

然而，虽然你可以用 Java 语言编写 Android 程序，但 Android 设备不能运行 Java 应用。相反，您的 Java 代码被转换成在 Dalvik 虚拟机上运行的东西。这类似于用于常规 Java 应用的技术，但 Dalvik 是专门为 Android 环境调整的。此外，它将 Android 对 Java 本身的依赖限制在少数编程工具上，这一点很重要，因为 Java 的管理权从 Sun 转移到 Oracle，再到 anywhere。

Dalvik 虚拟机还能够运行来自其他编程语言的代码，这一特性使得本书涵盖的大部分内容成为可能。

### ...这很好

没有一个移动开发环境是完美的，Java 和 Android 的结合也不例外。

一开始，Java 是为 Dalvik 虚拟机实现的，它是被解释的，没有任何常规 Java 用来提高性能的实时(JIT)编译器技巧。这在移动领域是一个更大的问题，因为运行 Android 的设备往往不如普通的台式机、笔记本电脑或网络服务器强大。Android 2.3 增加了一个 JIT 编译器，帮助很大，但是相比原生编译代码还是比较慢。因此，有些事情你不能在装有 Java 的 Android 上做，因为它太慢了。

Java 使用垃圾收集使人们不必跟踪所有的内存分配。这在很大程度上是可行的，通常有利于开发人员的生产力。然而，它不是解决所有内存和资源分配问题的灵丹妙药。即使这些泄漏的精确机制不同于 C、C++ 和其他语言中的经典泄漏，Java 中仍然可能存在所谓的“内存泄漏”。

然而，最重要的是，并不是每个人都喜欢 Java。这可能是因为他们缺乏这方面的经验，或者他们有过这方面的经验，但并不喜欢这种经验。当然，Java 通常被视为大型企业系统的语言，因此不一定“酷”其他语言的拥护者对 Java 也有自己的烦恼(例如，对于 Ruby 开发人员来说，Java 实在是太冗长了)。

因此，尽管 Java 对 Android 来说是个不错的选择，但它也不是完美的。

### 逆势而为

仅仅因为 Java 是为 Android 构建应用的主要方式，这并不意味着它是唯一的方式，对你来说，它甚至可能不是最好的方式。

也许 Java 不在你现有的技能范围内。您可能是一名 web 开发人员，更熟悉 HTML、CSS 和 JavaScript。有一些框架可以帮助你。或者，也许你已经开始接触服务器端脚本语言，比如 Perl 或 Python——也有办法将这些代码移植到 Android 上。或者也许你已经有了一堆 C/C++ 代码，比如游戏物理算法，用 Java 重写会很痛苦。您也应该能够重用这些代码。

即使你愿意学习 Java，你对 Java 和 Android APIs 的缺乏经验也可能会拖你的后腿。您也许能够用另一个框架更快地构建一些东西，即使将来您最终用一个基于 Java 的实现来替换它。快速开发和原型制作通常是很重要的，以便用最少的时间投入获得早期反馈。

当然，你可能会觉得 Java 编程很烦人。你不会是第一个，也不会是最后一个有这种想法的人。如果你把 Android 当成一种爱好，而不是你“日常工作”的一部分，享受乐趣将对你特别重要，你可能不会觉得 Java 很有趣。

幸运的是，与一些移动平台不同，Android 对构建应用的替代方式很友好。

### 支架，结构

但是，“友好”和“全力支持”是两回事。基于 Java 的开发的一些替代方案得到了核心 Android 团队的官方支持，例如通过原生开发工具包(NDK)的 C/C++ 开发和通过 HTML5 的 web 风格开发。一些公司支持基于 Java 的开发的替代方案。Adobe 支持 Adobe Integrated Runtime (AIR)，最近还收购了以支持 PhoneGap 而闻名的 Nitobi(详见第四十六章)，Rhomobile 支持 Rhodes，等等。标准机构支持其他替代方案。例如，万维网联盟(W3C)支持 HTML5。还有一些只是由几个开发商支持的小项目。

您需要自己决定这些支持级别中的哪一个能够满足您的要求。对于许多开发活动来说，支持不是大问题，但是在某些情况下，支持可能是最重要的(例如，企业应用开发)。

### 警告开发者

当然，在传统的 Java 环境之外进行 Android 开发也有它的问题，不仅仅是可以获得多少支持。

就处理器时间、内存或电池寿命而言，有些环境可能不如 Java 有效。C/C++ 总体来说可能比 Java 好，但是比如 HTML5 可能就差一些。根据你写的内容和它的使用量将决定这种低效率有多严重。

有些环境可能无法在所有设备上使用。现在，Flash 就是最好的例子；一些设备提供一定量的闪存支持，而另一些设备根本没有闪存支持。类似地，HTML5 支持仅从 Android 2.0 开始添加到 Android，因此运行旧版本 Android 的设备没有 HTML5 作为内置选项。

当新版本的 Android 出现时，你和官方支持的环境之间的每一层都使你更难确保与新版本的 Android 兼容。例如，如果您使用 PhoneGap 创建一个应用，并且一个新的 Android 版本变得可用，那么可能会出现不兼容的问题，只有 PhoneGap 团队能够解决。虽然他们可能会很快解决这些问题——并且他们可能会为您提供一些隔离这些不兼容性的措施——但响应时间是您无法控制的。在某些情况下，这不是问题，但在其他情况下，这可能对您的项目不利。

因此，仅仅因为你在 Java 之外开发并不意味着一切都是完美的。您只需在这些问题和基于 Java 的开发可能给您带来的问题之间进行权衡。平衡点在哪里取决于每个开发商或公司。