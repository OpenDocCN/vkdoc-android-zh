# 六、数字视频：概念和术语

现在，您已经了解了数字音频新媒体内容和 Android Studio 文件格式优化的基本概念、术语和原则，是时候了解数字视频新媒体的概念、术语和原则了。Android Studio 支持的两种流行文件格式是 WebM 和 MPEG-4 AVC。您将了解模拟视频(电影)背后的概念，并学习如何将其数字化为数字视频，因为许多模拟电影和数字视频概念适用于这两种媒体。

您将了解如何使用高速显示的图像帧创建数字视频，并学习帧速率和分辨率等数字视频概念。您还将了解高级数字视频播放概念，如比特率、视频流、高清音频和受控数字视频。

最后，您将看到 Android Studio 支持的开源数字视频编解码器和数字视频文件格式，您将使用它们来开发 Android 新媒体应用。

## 数字视频概念和术语

数字视频由数字图像和数字音频组成，这也是我在本书前半部分讲述这些章节的原因。数字视频素材使用 Android 的数字视频兼容类，如 VideoView、MediaController 和 MediaPlayer。MediaPlayer 和 MediaController 类也与数字音频素材兼容，因此可用于数字音频或数字视频播放。

除了视频剪辑播放之外，数字视频还可以用于 Android Studio 应用开发中的许多事情。您可以在用户界面设计中、在背景中或结合 i3D 项目设计使用数字视频。

### 数字视频概念:帧和帧速率

数字视频将数字图像延伸到 4D，时间的第四维度。这是通过数字视频和电影行业中称为帧的东西来完成的。一帧只是一个数字图像，它包含在一组略有不同的数字图像中，使其成为一种数字视频素材。

您的数字视频素材由有序的帧序列组成，这些帧序列可以快速显示，并产生预期的运动图像幻觉。

2D 数字视频素材框架的基本概念建立在 2D 数字影像的基本概念之上。数字视频帧还包含每个图像帧的像素，这意味着数字视频素材也具有分辨率、纵横比和色深。数字视频资源中的所有帧必须使用完全相同的分辨率、宽高比和色深。

大多数数字视频资源使用 24 位色深，这也是 Android 所支持的。索引彩色视频确实存在，因为微软视频 1 编解码器要么在 [8 位](https://en.wikipedia.org/wiki/List_of_software_palettes#Adaptive_palettes%23List%20of%20software%20palettes) [托盘化](https://en.wikipedia.org/wiki/Palette_(computing)#Palette%20(computing))颜色模式中运行，要么在 [15 位 RGB](https://en.wikipedia.org/wiki/List_of_monochrome_and_RGB_palettes#15-bit_RGB%23List%20of%20monochrome%20and%20RGB%20palettes) _565 颜色空间中运行。动画 GIF(GIF 或 AnimGIF)可以索引运动视频图形资源的调色板，但目前 Android API 中不支持 Microsoft Video 1 或动画 GIF。

就像数字图像中的像素一样，数字视频帧会随着每一帧的使用而增加你的数据足迹，正如你将在第七章中看到的。在数字视频中，不仅数字视频帧的分辨率会极大地影响最终文件的大小，而且在视频编码过程中，编解码器需要分析和压缩的每秒帧数也会影响最终文件的大小。如您所知，要压缩的数据越多，文件就越大，即使压缩算法正在减少数据。

这个每秒帧数通常称为 FPS，在数字视频和电影制作行业中也通常称为“帧速率”。

常见的帧率包括 i3D 主机游戏 60 FPS，数字视频 30 FPS，故事片 24 FPS，多媒体 20 FPS。正如你将在第七章中看到的，有一些新的媒体内容支持更低的帧速率，比如 15 FPS 或 12 FPS。

根据每秒帧数(FPS)值，将 1 除以 FPS 值，即可得出每帧显示的时间。

因此，20 FPS 帧显示 0.05 秒，30 FPS 帧显示 0.033 秒，24 FPS 帧显示 0.04167 秒，60 FPS 帧显示 0.0167 秒，依此类推。接下来，让我们看看计算原始视频数据或所需系统内存量的数学方法。

### 数字视频数学:做乘法

在第二章中，您了解到如果您将图像中的像素数量乘以颜色通道的数量，您将获得该图像的原始数据足迹。对于数字视频，您将该数字乘以数字视频设定回放的每秒帧数，以获得每秒的数据足迹。要获得总的数据占用量，您需要将该数字再次乘以代表视频剪辑持续时间的秒数。

因此，对于 VGA 或 SD 视频，分辨率为 640×480，色深为 24 位，只有一帧视频的`[(640x480)x3]=921,600`。在 30 FPS 时，这是`921,600x30=27,648,000`字节的数据。用这个除以 1024，你就有 27，000 KB 的数据，或者一秒钟视频的 27 MB 原始数据(或系统内存)。

您可以看到为什么拥有一个强大的视频编解码器，在最佳压缩设置的情况下，将原始数据压缩一个数量级是极其重要的！接下来让我们看看数字视频编解码器算法，这样您就可以了解编解码器是如何实现这一点的。

### 数字视频算法:数字视频编解码器

一旦您确切了解如何最佳优化数字视频压缩工作流程，您将会对使用 MPEG-4 和 WebM 视频文件格式实现的一些数字视频数据压缩率感到惊讶。这是通过为您的数字视频内容和特定应用使用正确的比特率、帧速率、帧分辨率和色深来实现的。

在第七章中，当您在 Terragen 3.3 中创建(渲染)3D 视频内容，使用 AVI 文件格式封装它，然后使用 Sorenson Squeeze Pro 软件压缩它时，您将采取实践的方法来学习这一点。所以下一章你可以把重点放在软件上；在这一章中，我试图涵盖适用于您的数字视频数据足迹优化工作流程的所有概念和理论。我正在写一章关于理论，一章关于为每种新媒体类型使用软件。

让我们看看数字视频编解码器与数字音频或数字图像编解码器有何不同。在数字视频压缩算法中，有一些数字图像和数字音频压缩的元素，但是它可以更复杂一个数量级，因为它必须确定和压缩帧间像素运动。因此，编解码器不仅在 2D 空间(像素和波形)中压缩，而且还在 4D 空间中压缩；也就是说，帧之间的任何变化。出于这个原因，摄像头视频，或者没有平移或缩放的视频，压缩得更好，因为有像素在帧之间不移动。

### Android 中的视频:MPEG-4 H.264 AVC 和 WebM

Android Studio 支持 HTML5 支持的两种开源数字视频格式:MPEG-4 H.264 AVC 和 ON2 VP8 和 ON2 VP9 编解码器，这两种编解码器是谷歌从 ON2 Technologies 收购的。Google 重命名了这些 WebM，然后以开源许可模式发布了它们。从内容制作的角度来看，这是一个好消息，因为开发人员制作和优化的视频内容可以用于 HTML5 应用、浏览器和硬件设备，以及 Android Studio 应用。Android 5.0 及更高版本还增加了对 MPEG-4 H.265 HEVC 的支持(仅回放)。

这种数字视频格式跨平台支持为内容开发者提供了每个内容制作者和程序员梦寐以求的“一次制作，随处发布”的制作场景。这可以降低内容开发成本，从而增加你的收入，只要内容开发中的“规模经济”被开发者所利用。

由于目前所有 Android 设备的显示器都使用中(1280×720)到高(1920×1800)分辨率，有些设备使用超高(4096×2160)分辨率，因此您可以使用 MPEG-4 H.264 AVC 格式。这是当今世界上最常用于 Android 或 HTML5 的数字视频格式。

#### MPEG-4 H.264 AVC:使用和支持最广泛的编解码器

这种 MPEG-4 H.264 AVC(高级视频编码)视频文件格式在每个 Android 版本上都支持回放，在 Android 3.0 和更高版本中支持视频录制。

如果你是一名视频内容制作人，你会发现这种 MPEG-4 H.264 AVC 格式提供了最好的压缩结果，特别是如果你使用的是更高级的编码套件之一，如 Sorenson Squeeze Professional 软件，你将在第七章中使用该软件来优化我们的 3D 视频素材。

MPEG-4 数字视频的文件扩展名支持包括. 3GP (MPEG4 SP 或标准播放)和. MP4 (MPEG4 H.264 AVC)。我建议用后者的 MPEG-4 AVC，HTML5 我用的就是这个；MP4 更常见于 AVC 格式的流媒体，但这两种类型的扩展在 Android 应用中都应该工作得很好。

#### ON2 VP8 和 VP9:新的 WebM 或网络电影格式

Android Studio 支持的最新数字视频格式称为 WebM 数字视频格式。这种格式还能以较小的数据占用空间提供高质量的结果。这就是谷歌收购 ON2 的原因，ON2 是开发 VP8 和 VP9 编解码器的公司。Android 2.3 首次原生支持播放 WebM 视频。术语“本地支持”与 API 代码一起使用；在这种情况下，它是一个编解码器，已经成为 Android 操作系统的一部分。

WebM 还支持视频流，这一点你也将在本章的后面部分了解到。Android 4 和更高版本支持 WebM 视频流播放功能。

出于这个原因，我建议使用 WebM 作为强制视频素材，因为 Android 2.3 到 5.4 支持非流式 WebM 编解码器。

如果你想知道，强制视频是非流式视频，其中视频素材被强制保存在`/res/raw/`文件夹中。第三章第三章介绍了数字音频的概念和技术，您将首次接触到受控与流媒体的概念。

如果你只打算流视频，使用 MPEG-4 H.264 AVC，因为自 1.5 以来，所有 Android Studio 版本和所有 Android API 级别都支持该编解码器。

### 数字视频分辨率:行业标准

让我们从商业视频中使用的主要分辨率开始。在 HDTV(高清晰度电视)出现之前，视频被称为“SD”，即标准清晰度，使用 480 像素的标准垂直分辨率。SD 的原始纵横比为 4:3 (640×480)。最近，增加了宽屏宽高比，使标清视频分辨率达到 720×480。

高清分辨率视频有两种不同的分辨率:1280×720，我称之为“伪高清”，1920×1080，视频行业称之为“真高清”两者都使用 16:9 的宽屏宽高比，现在不仅用于电影、高清电视和 iTV 电视机，还用于智能手机(Razor HD 为 1280×720)和平板电脑(Kindle Fire HD 为 1920×1200)。

顺便说一下，1920×1200 的分辨率是一个不太宽或较高的 16:10 像素纵横比。作为一种宽屏设备宽高比，它变得越来越常见，16:8 或 2:1 宽高比也是如此，自 2013 年以来，2160×1080 屏幕已在市场上出现。

还有 16:10 伪高清分辨率，1280×800 像素。其实这是常见的笔记本电脑，笔记本，上网本，中型平板分辨率。在某个时候看到 16:8 的 1280×640 屏幕，我不会感到惊讶。

一般来说，内容开发者试图将视频内容分辨率与他们的视频资源将被观看的每个 Android 设备的分辨率(以及纵横比)相匹配。

类似地，制造商试图使显示屏分辨率与流行的内容分辨率相匹配。蓝光是 1280×720，因此有许多 1280×720 屏幕和 2560×1440 屏幕尺寸(对于蓝光内容中的每个像素，每个轴上 1280×720 的两倍可以完美地放大到 4 像素(2x2)矩阵。

### 数字视频存储:专属与流媒体

无论您为数字视频内容选择何种分辨率，Android Studio 应用都可以通过几种不同的方式访问视频。我做这件事的方式，因为我是一个数据优化狂，是一个应用的俘虏。这意味着数据在 Android 应用的 APK 文件中，在/ `res/raw/ raw`数据资源文件夹中。

另一种在你的 Android 应用中访问视频的方法是使用远程视频数据服务器。在这种情况下，当视频实时播放时，视频通过互联网从远程服务器流式传输到用户的 Android 设备。让我们希望你的视频服务器不会崩溃，这是流媒体视频相对于捕获视频的缺点之一。

视频流本质上比播放受控数字视频更复杂。这是因为 Android 设备正在与远程数据服务器实时通信，接收视频数据包，在视频播放时解码数据包，然后将帧写入 Android 硬件显示器。Android 4 和更高版本的设备使用 WebM 格式通过 WebM 支持视频流，或者在所有 Android 操作系统版本上使用 MPEG-4 支持视频流。

### 数字视频压缩:比特率和回放

你需要学习的另一个重要的数字视频概念是比特率。比特率是视频压缩过程中使用的一个关键设置，您将在第七章中使用 Sorenson Squeeze Pro 10 时看到。比特率代表目标带宽或数据管道大小，它能够容纳每秒钟流过它的一定数量的数据比特。比特率还需要考虑任何给定 Android 手机的 CPU 处理能力，这使得视频数据优化对 Android Studio 应用的播放质量更加重要。

这是因为一旦比特通过数据管道，它们也需要被处理，然后显示在设备屏幕上。事实上，Android APK 文件中包含的专属视频资源只需要对处理能力进行优化。这样做的原因是，如果您使用的是强制视频文件，则没有视频资源通过的数据管道，因此没有数据传输开销。因此，数字视频素材的比特率不仅需要针对数据带宽进行优化，还需要考虑 CPU 能力的变化。

一般来说，视频数据文件越小，数据通过数据管道传输的速度就越快，使用编解码器和 CPU 解码数据就越容易，Android APK 文件也就越小。

智能手表等设备中的单核 CPU 可能无法在不“丢弃”帧的情况下解码高分辨率、高比特率的数字视频素材。这是一个播放质量问题，因此如果您打算使用较旧(或较便宜)的设备，请确保彻底优化较低比特率的视频素材。

### 数字视频优化:编码软件

我将在本章的最后一部分介绍数字视频优化理论，这样您就可以在第七章中专注于工作流程和软件。您的数字视频编解码器的解码器端总是针对速度进行优化，因为回放的平滑度是关键问题；编码器端经过优化，可减少其生成的数字视频素材的数据占用量。因此，编码过程可能需要很长时间，这取决于工作站包含多少个处理核心。大多数视频内容制作工作站应该支持八个、十二个或十六个处理器内核，以便编码速度更快，特效渲染速度更快。

编码器端的编解码器在某种意义上类似于插件，它们可以被安装到不同的数字视频编辑软件包中，以编码不同的数字视频素材文件格式。由于 Android 操作系统支持视频的 H.263、H.264 和 H.265 MPEG-4 格式以及 ON2 VP8 和 VP8 WebM 格式，因此您需要确保您使用的是将视频数据编码为数字视频文件格式的编解码器之一。

不止一个软件制造商生产 MPEG4 编码软件，所以就编码速度和文件大小而言，有产生不同(更好或更差)结果的 MPEG 编解码器编码器软件。

如果您希望对数字视频素材进行编码，我推荐 Sorenson Media 的专业编码解决方案 Sorenson Squeeze Pro，它目前是第 10 版。

Squeeze 有专业级版本，我在本书中会用到；它的价格约为 1000 美元，但如果你考虑它的功能，它的价值超过了建议的标价。也有更便宜的软件版本。

还有一个开源解决方案叫做 Editshare Lightworks 12.5，但是免费版目前不支持使用 MPEG-4 AVC 和 WebM VP8 或 VP9 编解码器的输出；虽然 WebM 编码解码器是开源的，所以这种支持可能会增加。所以我得用 Sorenson Squeeze Pro 10 来出书。(或许 Editshare Lightworks 12.5，或者更高版本会加入对 Android Studio 和 HTML5 的编解码器支持。访问 Lightworks 论坛——用户要求在 Lightworks 中添加 WebM 支持。

### 数字视频优化:编码器设置

使用编码器设置优化数字视频素材文件大小时，有许多重要设置会直接影响数据占用空间。我将按照它们影响文件大小的顺序来讨论这些问题，从影响最大到影响最小，这样您就知道应该“调整”或调整哪些参数来获得您想要的结果。与数字图像压缩一样，视频每帧的分辨率或像素数是开始数据优化过程的最佳位置。如果您的目标是 1280×720 的智能手机或平板电脑，您不需要使用 1920×1080 的分辨率来从您的数字视频素材中获得出色的视觉效果。

使用目前在 Android 市场上常见的高密度，也称为“精细点距”显示器(Android 的 HDPI、XHDPI、XXHDPI 和 XXXHDPI)，您可以将 1280 视频放大 33%，看起来相当不错。Android TV 上的 iTV 应用是一个例外，由于 55 到 95 英寸的大屏幕尺寸，它的 MDPI 点距中等。如果您正在为 iTV 电视机开发应用，您希望使用 1920×1080 的“真高清”分辨率，以便您的内容触及每个像素。这可以扩大到 3840×2160，以支持 UHD 的良好效果。

下一个优化级别是每秒视频使用的帧数(FPS)。这是假设视频本身包含的实际秒数不能通过编辑来缩短。这被称为帧速率；因此，考虑使用 24 FPS 的电影标准帧速率或 20 FPS 的多媒体标准帧速率，而不是设置 30 FPS 的视频标准帧速率。根据您的内容，您可以使用较低的 15 FPS 帧速率。

请注意，15 FPS 是 30 FPS 的一半，也就是说进入编码器的数据减少了 100%。对于某些视频内容，这与 30 FPS 的内容播放效果相同。在 FPS 开始影响您的视频播放质量之前，测试您可以获得多低的 FPS 的唯一可靠方法是在您的数字视频(编码器)内容优化工作过程中，使用不同的帧速率设置来设置、编码和查看结果。

为了获得更小的数据占用空间，下一个需要调整或试验的最佳设置是编解码器的比特率。比特率设置等同于应用的压缩量，从而设置视频数据的视觉质量。值得注意的是，您可以简单地使用 30 FPS、HD 1920×1080 视频，并指定低比特率上限。但是，如果您这样做，结果看起来不会像您第一次使用较高(质量)比特率设置试验较低的帧速率和分辨率那样好。

获得小数据足迹的第二个最有效的设置是关键帧的数量。编解码器使用您的关键帧设置来了解何时对数字视频进行采样。视频编解码器通过查看一帧来应用压缩，然后只对接下来几帧中的变化或偏移进行编码，这样就不必对视频数据流中的每一帧都进行编码。这就是为什么一个正在说话的头部视频比每个像素在每个帧上移动的视频编码得更好，例如具有快速平移或快速缩放的视频。

编码器中的关键帧设置会强制编解码器不时获取视频数据资源的新帧样本。关键帧通常有一个自动设置；这允许编解码器决定要采样的关键帧的数量。还有一个手动设置，允许您指定关键帧采样的频率，通常是每秒特定次数，或视频持续时间内特定次数(总帧数)。

在获得小数据足迹方面，下一个最有效的设置是质量或锐度设置，通常使用滑块来实现。锐度控制压缩前编解码器应用于视频像素的模糊量。如果您想知道这个技巧是如何工作的，以便您可以在自己的数字图像优化工作过程中在 GIMP 中应用它，那么对您的图像或视频应用轻微的模糊(这通常是不可取的)可以实现更好的压缩。其原因是图像中的尖锐过渡(例如颜色之间的尖锐边缘)对于编解码器来说更难以最佳编码；也就是说，它使用较少的数据。更准确地说(没有双关的意思)，颜色的急剧或突然过渡比柔和过渡需要更多的数据来再现。我建议将质量或清晰度滑块保持在 85%和 100%的质量设置之间，并尝试使用这里讨论的其他变量来减少数据占用。

最终，您需要微调大量不同的变量，以实现每个特定视频数据素材的最佳数据占用优化。每一个对于编解码器来说都是不同的(数学上),因为每个视频资源可以是不同的像素颜色数据阵列(集合)。因此，不存在可以用来实现任何给定结果的“标准”设置集合。

您调整各种设置的经验可能最终会让您更好地了解需要更改哪些设置才能获得想要的压缩结果。

同样，在第七章中，你会获得一些实际操作的经验。

## 摘要

在本章中，您了解了压缩和解压缩数字视频素材的数字视频概念、原理和 Android 格式。您了解了分辨率、色深、帧速率、比特率和编解码器设置如何有助于减少数字视频素材数据占用空间。

在下一章中，您将了解如何使用流行的软件包优化数字视频数据占用空间。